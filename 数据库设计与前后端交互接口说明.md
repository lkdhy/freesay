## æ•°æ®åº“è®¾è®¡ä¸å‰åç«¯äº¤äº’æ¥å£è¯´æ˜

[TOC]

### å‰åç«¯äº¤äº’æ¥å£

#### å‰ç«¯æ–‡ä»¶å‚è€ƒ

* å¯¹åº”*ç»„ä»¶*ä¸­çš„äº¤äº’å¤„ï¼Œå¦‚ [LoginForm.vue](frontend/src/components/LoginForm.vue) ä¸­ï¼š

  > ```typescript
  > let res = await PostApi({
  >          username: postForm.username,
  >          hostUsername: tmp,
  >          question: postForm.question
  >        });
  > ```

* ğŸ”¥ [api.ts](frontend\src\request\api.ts)

  > ```typescript
  > // api.ts
  > // my APIs
  > export const GetBoxApi = (): BoxRes<null> =>
  >  	instance.get('/api/box');
  > export const ShareApi = (data: ReqShare): Res<null> =>
  >  	instance.post('/api/share', data);
  > export const PostApi = (data: Post): Res<null> =>
  >  	instance.post('/api/postâ€™, data);
  > // ...
  > //ç™»å½• api
  > export const LoginApi = (data: ReqLogin): Res<null> =>
  >  	instance.post('/api/login', data);
  > //æ³¨å†Œ api
  > export const RegisterApi = (data: ReqRegister): Res<null> =>
  >  	instance.post('/api/register', data);
  > // ...
  > ```

#### ã€TODOã€‘åŸºæœ¬ç”¨æˆ·ç›¸å…³æ¥å£

> ==æœ‰é—®é¢˜éšæ—¶å¾®ä¿¡äº¤æµ==ã€‚å®Œæˆäº†å¯ä»¥å‰é¢æ‰“âœ”

- [x] ##### ã€TODOã€‘ç”¨æˆ·æ³¨å†Œ

  > [RegisterForm.vue](frontend/src/components/RegisterForm.vue)

  - [x] ==åŠ ä¸Šä¸å¾—æœ‰ç›¸åŒç”¨æˆ·åçš„åˆ¤æ–­ï¼ˆè§ä¸‹é¢â¬‡ï¼‰==

  * æ–¹æ³•ï¼špost

  * è¯·æ±‚ URLï¼š`/register`

  * å‘é€æ•°æ®ï¼š`{usename: string, password: string, first_name: string, last_name: string, email: string, signature: string}`

  * è¿”å›æ•°æ®ï¼š`{success: boolean, msg: string, total_users: number}`

    å…¶ä¸­ `success` è¡¨ç¤ºæ³¨å†Œç»“æœ==ï¼ˆç¦æ­¢æœ‰ç›¸åŒçš„ç”¨æˆ·åï¼‰==ï¼Œ`msg` ä¸ºç›¸å…³æ¶ˆæ¯æç¤ºï¼ˆä¾¿äºè°ƒè¯•ï¼‰ï¼Œ==`total_users` ä¸ºè¿™ä¸ªç”¨æˆ·æ³¨å†Œåå…±æœ‰å‡ ä½ç”¨æˆ·==	

    * æ³¨å†ŒæˆåŠŸï¼š`{success: true, msg: 'æ³¨å†ŒæˆåŠŸ', total_users: ?}`
    * **==æ³¨å†Œå¤±è´¥ï¼š`{success: false, msg: 'ç”¨æˆ·å...å·²å­˜åœ¨'}`ã€‚å°±ç®—è¿”å›äº† `{success: false, msg: 'ç”¨æˆ·å...å·²å­˜åœ¨', total_users: éšä¾¿ä¸€ä¸ªå€¼}` ä¹Ÿæ²¡å…³ç³»ï¼==**

  > æ³¨æ„ï¼šä¸Šé¢å’Œ Python è¯­æ³•ä¸å®Œå…¨ç­‰ä»·ï¼åªæ˜¯ç”¨ç±» JSON å½¢å¼è¿›è¡Œç¤ºä¾‹ï¼Œä¸‹åŒã€‚

- [x] ##### ç”¨æˆ·ç™»å½•

  * æ–¹æ³•ï¼špost

  * è¯·æ±‚ URLï¼š`/login`

  * å‘é€æ•°æ®ï¼š`{usename: string, password: string}`

  * è¿”å›æ•°æ®ï¼š`{success: boolean, msg: string, isAdmin: boolean}`

    å…¶ä¸­ `success` è¡¨ç¤ºç™»å½•ç»“æœï¼Œ`msg` ä¸ºç›¸å…³æ¶ˆæ¯æç¤ºï¼ˆä¾¿äºè°ƒè¯•ï¼‰ã€**`isAdmin` ä¸ºæ˜¯å¦ä¸ºç®¡ç†å‘˜**

    * ç™»å½•æˆåŠŸï¼š`{success: true, msg: 'ç™»å½•æˆåŠŸ', isAdmin: false/true}`
    * ç™»å½•å¤±è´¥ï¼š`{success: false, msg: 'ç™»å½•å¤±è´¥'}`ã€‚å°±ç®—è¿”å›äº† `{success: false, msg: 'ç™»å½•å¤±è´¥', isAdmin: éšä¾¿ä¸€ä¸ªå€¼}` ä¹Ÿæ²¡å…³ç³»ï¼

- [x] ##### è·å–æŸé¡µçš„ç”¨æˆ·ä¿¡æ¯

  ```typescript
  export const GetUserInfoByPageNum = (params: { 'pageNumber': number, 'number': number}): Res<null> =>
      instance.post(`/api/users/list`, params);
  ```

#### ==ã€TODOã€‘å…¶å®ƒæ¥å£==

- [x] ##### åˆ†äº«æé—®ç®±

  * æ–¹æ³•ï¼špost
  * è¯·æ±‚ URLï¼š`/share`

  ```typescript
  // api.ts
  interface ReqShare {
      username: string
      description: string
  }
  export const ShareApi = (data: ReqShare): Res<null> =>
      instance.post('/api/share', data);
  ```

- [x] ##### è·å–å½“å‰æ‰€æœ‰åˆ†äº«çš„æé—®ç®±ä¿¡æ¯

  * ==æ–¹æ³•ï¼šget==
  * è¯·æ±‚ URLï¼š`/box`

  ```typescript
  // api.ts
  interface Box {
      username: string,
      description: string
  }
  // ...
  export const GetBoxApi = (): BoxRes<null> =>
      instance.get('/api/box');
  ```

- [x] ##### å‘åˆ«äººæé—®ï¼ˆâ€œpo å¸–å­â€ï¼‰

  * æ–¹æ³•ï¼špost
  * è¯·æ±‚ URLï¼š`/post`
  * è¿”å›æ•°æ®ï¼š`{success: boolean, message: string}`*ï¼ˆä¾‹ï¼š`{success: true, msg: 'æé—®æˆåŠŸ'}`ï¼‰*

  ```typescript
  interface Post {
      username: string,
      hostUsername: string,
      question: string
  }
  export const PostApi = (data: Post): Res<null> =>
      instance.post('/api/post', data);
  ```

- [ ] ##### ==ã€TODOã€‘ä¸»äººå›ç­”åŒ¿åæé—®==

  * æ–¹æ³•ï¼špost

  * è¯·é—® URLï¼š`/answer`

  * å‘é€æ•°æ®ï¼š`{ 'id': number, 'answer': string, 'is_public': boolean }`

    ==å…¶ä¸­ `id` ä¸ºå¯¹åº”çš„ `post_id`==ï¼Œ`answer` ä¸ºå›ç­”ï¼Œ`is_public` çš„å¸ƒå°”å€¼è¡¨ç¤ºå›ç­”æ˜¯å¦å…¬å¼€

  * è¿”å›æ•°æ®ï¼š`{success: boolean, message: "æ”¶åˆ°å›ç­”å¹¶ä¿å­˜æˆåŠŸ"}`

  ```typescript
  export const AnswerApi = (params: { 'id': number, 'answer': string, 'is_public': boolean } ): Res<null> =>
      instance.post('/api/answer', params)
  ```

- [ ] â€¦â€¦ ä¼¼ä¹æš‚æ—¶æ²¡äº†ï¼Ÿ

---

### æ•°æ®åº“è®¾è®¡

**ä¸‰ä¸ªå®ä½“ï¼š**ç”¨æˆ·ã€åˆ†äº«çš„æé—®ç®±ã€é—®ç­”å¸–ã€‚ï¼ˆå±æ€§å’Œ ER å›¾ç•¥ï¼‰

$\Rightarrow$ æ–¹ä¾¿åœ°å¯¹åº”ä¸‹é¢ä¸‰å¼ è¡¨â¬‡

#### å…³ç³»æ¨¡å¼ï¼ˆè¡¨æ ¼ï¼‰è®¾è®¡

> ==æœ‰é—®é¢˜éšæ—¶å¾®ä¿¡äº¤æµ==ã€‚å®Œæˆäº†å¯ä»¥å‰é¢æ‰“âœ”

- [x] ã€TODOã€‘Mysql åˆ›å»ºä¸‹é¢çš„ä¸‰å¼ è¡¨

> <u>ä¸‹åˆ’çº¿</u>æ˜¯ä¸»é”®ï¼›*æ–œä½“*æ˜¯å¤–é”®

* user è¡¨ï¼š<u>ç¼–å· user_id</u>ã€ç”¨æˆ·å usernameã€æ˜¯å¦ä¸ºç®¡ç†å‘˜ is_superuserã€å§“ first_nameã€å last_nameã€é‚®ç®± emailã€ä¸ªæ€§ç­¾å signatureï¼ˆä¸å¾—ä¸ºç©ºï¼‰

  ==ä¸å¾—æœ‰ç›¸åŒç”¨æˆ·åï¼==

  > **Me: django è¿æ¥ mysqlï¼Œä¸€ä¸ªæ•°æ®åº“è¡¨æ ¼å±æ€§ä¸å¾—æœ‰ç›¸åŒå€¼**
  >
  > åœ¨Djangoä¸­ï¼Œå¦‚æœä½ æƒ³è®©ä¸€ä¸ªæ•°æ®åº“è¡¨æ ¼çš„æŸä¸ªå±æ€§ä¸å¾—æœ‰ç›¸åŒå€¼ï¼Œä½ å¯ä»¥åœ¨è¯¥å±æ€§çš„å®šä¹‰ä¸­ä½¿ç”¨å‚æ•°`unique=True`ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š
  >
  > ```python
  > from django.db import models
  > 
  > class MyModel(models.Model):
  >     my_field = models.CharField(max_length=200, unique=True)
  > ```
  >
  > åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`my_field`æ˜¯ä¸€ä¸ªå­—ç¬¦å­—æ®µï¼Œå®ƒçš„æœ€å¤§é•¿åº¦æ˜¯200ï¼Œå¹¶ä¸”å®ƒçš„å€¼å¿…é¡»åœ¨æ•´ä¸ªè¡¨ä¸­æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä½ è¯•å›¾å°†ä¸¤ä¸ªå…·æœ‰ç›¸åŒ`my_field`å€¼çš„å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒDjangoå°†å¼•å‘`django.db.IntegrityError`å¼‚å¸¸ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½ çš„æ•°æ®åº“è¡¨å·²ç»æœ‰é‡å¤çš„å€¼ï¼Œé‚£ä¹ˆæ·»åŠ `unique=True`å°†ä¸ä¼šèµ·ä½œç”¨ï¼Œå› ä¸ºè¿™å°†è¿åå”¯ä¸€æ€§çº¦æŸã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦é¦–å…ˆåˆ é™¤æˆ–æ›´æ”¹é‡å¤çš„å€¼ã€‚

  ã€postgresç¤ºä¾‹ã€‘*ï¼ˆæ²¡æœ‰å¿…è¦å’Œä¸‹é¢ä¸€æ ·ï¼ï¼‰*

  ```mysql
       æ ä½     |          ç±»å‹          | æ ¡å¯¹è§„åˆ™ |  å¯ç©ºçš„  |                 é¢„è®¾
  --------------+------------------------+----------+----------+---------------------------------------
   id           | integer                |          | not null | nextval('auth_user_id_seq'::regclass)
   username     | character varying(255) |          | not null |
   password     | character varying(255) |          | not null |
   is_superuser | boolean                |          | not null |
   first_name   | character varying(255) |          | not null |
   last_name    | character varying(255) |          | not null |
   email        | character varying(255) |          | not null |
   is_active    | boolean                |          | not null |
   signature    | character varying(60)  |          | not null |
  ç´¢å¼•ï¼š
      "auth_user_pkey" PRIMARY KEY, btree (id)
      "auth_user_username_key" UNIQUE CONSTRAINT, btree (username)
  ç”±å¼•ç”¨ï¼š
      TABLE "post" CONSTRAINT "post_host_id_fkey" FOREIGN KEY (host_id) REFERENCES auth_user(id)
      TABLE "post" CONSTRAINT "post_poster_id_fkey" FOREIGN KEY (poster_id) REFERENCES auth_user(id)
  ```

* box è¡¨ï¼š<u>ç¼–å· box_id</u>ã€*åˆ†äº«è€…ç¼–å· host_id*ã€æè¿° descr

  

* post è¡¨ï¼š<u>ç¼–å· post_id</u>ã€*æé—®è€…ç¼–å· poster_id*ã€*è¢«æé—®è€…ç¼–å· host_id*ã€é—®é¢˜ questionã€å›ç­” answerã€æ˜¯å¦å…¬å¼€ is_public

  * ==answer å¯ä»¥ä¸ºç©º==
  
  ã€postgresç¤ºä¾‹ã€‘*ï¼ˆæ²¡æœ‰å¿…è¦å’Œä¸‹é¢ä¸€æ ·ï¼ï¼‰*
  
  ```mysql
     æ ä½    |          ç±»å‹           | æ ¡å¯¹è§„åˆ™ |  å¯ç©ºçš„  |               é¢„è®¾
  -----------+-------------------------+----------+----------+----------------------------------
   id        | integer                 |          | not null | nextval('post_id_seq'::regclass)
   poster_id | integer                 |          | not null |
   host_id   | integer                 |          | not null |
   question  | character varying(1000) |          | not null |
   answer    | character varying(1000) |          |          |
   is_public | boolean                 |          | not null |
  ç´¢å¼•ï¼š
      "post_pkey" PRIMARY KEY, btree (id)
  å¤–éƒ¨é”®(FK)é™åˆ¶ï¼š
      "post_host_id_fkey" FOREIGN KEY (host_id) REFERENCES auth_user(id)
      "post_poster_id_fkey" FOREIGN KEY (poster_id) REFERENCES auth_user(id)
  ```

#### Mysql å®æ–½çš„è‡ªåŠ¨ç¼–å·

ã€é—®é¢˜ã€‘ä¸Šé¢çš„ postgres çš„é¢„è®¾ `nextval('post_id_seq'::regclass)` æ˜¯ä»€ä¹ˆï¼Ÿ

æ³¨æ„ï¼š$\Rightarrow$ Mysql ä¹Ÿæœ‰ç±»ä¼¼åŠŸèƒ½ã€‚

> **Meï¼šmysqlåˆ›å»ºè¡¨æ ¼ï¼Œè‡ªåŠ¨æŒ‰é¡ºåºç¼–å·**
>
> **ChatGPTï¼š**
>
> åœ¨MySQLä¸­ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå¢ä¸»é”®æ¥è‡ªåŠ¨æŒ‰é¡ºåºç¼–å·è¡¨æ ¼ä¸­çš„æ•°æ®ã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºè¡¨æ ¼å¹¶è‡ªåŠ¨æŒ‰é¡ºåºç¼–å·çš„ç¤ºä¾‹ï¼š
>
> ```
> CREATE TABLE your_table (
>     id INT AUTO_INCREMENT PRIMARY KEY,
>     name VARCHAR(255),
>     age INT
> );
> ```
>
> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`id` åˆ—è¢«å®šä¹‰ä¸º `INT AUTO_INCREMENT PRIMARY KEY`ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªè‡ªå¢ä¸»é”®ï¼Œæ¯æ¬¡æ’å…¥æ–°æ•°æ®æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é€’å¢å¹¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚
>
> æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥æ’å…¥æ•°æ®åˆ°è¯¥è¡¨æ ¼ä¸­ï¼Œè€Œæ— éœ€æŒ‡å®š `id` åˆ—çš„å€¼ï¼š
>
> ```
> INSERT INTO your_table (name, age)
> VALUES ('John', 25), ('Jane', 30), ('Bob', 35);
> ```
>
> æ’å…¥æ•°æ®åï¼Œ`id` åˆ—å°†è‡ªåŠ¨æŒ‰é¡ºåºç¼–å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
>
> ```
> +----+------+-----+
> | id | name | age |
> +----+------+-----+
> |  1 | John |  25 |
> |  2 | Jane |  30 |
> |  3 | Bob  |  35 |
> +----+------+-----+
> ```
>
> æ¯æ¬¡æ’å…¥æ–°æ•°æ®æ—¶ï¼Œ`id` åˆ—çš„å€¼å°†è‡ªåŠ¨é€’å¢ã€‚

---

> åœ¨ Django ä¸­ï¼Œæ¯å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼ŒDjango ä¼šè‡ªåŠ¨åœ°ä¸ºè¯¥æ¨¡å‹åˆ›å»ºä¸€ä¸ªåä¸º'id'çš„è‡ªåŠ¨å¢é•¿å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæ˜¯ä¸»é”®ï¼Œä¸”é»˜è®¤æŒ‰é¡ºåºç¼–å·ã€‚
>
> å¦‚æœä½ æƒ³è¦ä½¿ç”¨ MySQL çš„è‡ªåŠ¨æŒ‰é¡ºåºç¼–å·åŠŸèƒ½ï¼Œä½ åªéœ€è¦åœ¨æ¨¡å‹ä¸­å®šä¹‰å…¶ä»–å­—æ®µï¼ŒDjango ä¼šè‡ªåŠ¨å¤„ç†'id'å­—æ®µã€‚
>
> ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å‹ï¼š
>
> ```python
> from django.db import models
> 
> class MyModel(models.Model):
>     name = models.CharField(max_length=100)
>     description = models.TextField()
> ```
>
> åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDjango ä¼šè‡ªåŠ¨ä¸º`MyModel`åˆ›å»ºä¸€ä¸ª'id'å­—æ®µï¼Œè¿™ä¸ªå­—æ®µä¼šè‡ªåŠ¨åœ°æŒ‰é¡ºåºç¼–å·ã€‚
>
> ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦è‡ªå®šä¹‰ä¸»é”®çš„åå­—ï¼Œæˆ–è€…ä¸æƒ³è¦ä½¿ç”¨è‡ªåŠ¨å¢é•¿çš„ä¸»é”®ï¼Œä½ å¯ä»¥åœ¨æ¨¡å‹ä¸­å®šä¹‰è‡ªå·±çš„ä¸»é”®ï¼Œåªéœ€è¦åœ¨å­—æ®µä¸­è®¾ç½®`primary_key=True`å³å¯ã€‚ä¾‹å¦‚ï¼š
>
> ```python
> class MyModel(models.Model):
>     my_id = models.AutoField(primary_key=True)
>     name = models.CharField(max_length=100)
>     description = models.TextField()
> ```
>
> åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ'my_id'å°±æ˜¯è‡ªå®šä¹‰çš„ä¸»é”®ï¼Œå®ƒä¼šè‡ªåŠ¨åœ°æŒ‰é¡ºåºç¼–å·ã€‚
