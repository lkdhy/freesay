## 数据库设计与前后端交互接口说明

[TOC]

### 数据库设计

**三个实体：**用户、分享的提问箱、问答帖。（属性和 ER 图略）

$\Rightarrow$ 方便地对应下面三张表

#### 关系模式（表格）设计

==有问题随时微信交流==

- [ ] 【TODO】Mysql 创建下面的三张表

> <u>下划线</u>是主键；*斜体*是外键

* user 表：<u>编号 user_id</u>、用户名 username、是否为管理员 is_superuser、姓 first_name、名 last_name、邮箱 email、个性签名 signature（不得为空）

  【postgres示例】*（没有必要和下面一样！）*

  ```mysql
       栏位     |          类型          | 校对规则 |  可空的  |                 预设
  --------------+------------------------+----------+----------+---------------------------------------
   id           | integer                |          | not null | nextval('auth_user_id_seq'::regclass)
   username     | character varying(255) |          | not null |
   password     | character varying(255) |          | not null |
   is_superuser | boolean                |          | not null |
   first_name   | character varying(255) |          | not null |
   last_name    | character varying(255) |          | not null |
   email        | character varying(255) |          | not null |
   is_active    | boolean                |          | not null |
   signature    | character varying(60)  |          | not null |
  索引：
      "auth_user_pkey" PRIMARY KEY, btree (id)
      "auth_user_username_key" UNIQUE CONSTRAINT, btree (username)
  由引用：
      TABLE "post" CONSTRAINT "post_host_id_fkey" FOREIGN KEY (host_id) REFERENCES auth_user(id)
      TABLE "post" CONSTRAINT "post_poster_id_fkey" FOREIGN KEY (poster_id) REFERENCES auth_user(id)
  ```

* box 表：<u>编号 box_id</u>、*分享者编号 host_id*、描述 descr

  

* post 表：<u>编号 post_id</u>、*提问者编号 poster_id*、*被提问者编号 host_id*、问题 question、回答 answer、是否公开 is_public

  * ==answer 可以为空==
  
  【postgres示例】*（没有必要和下面一样！）*
  
  ```mysql
     栏位    |          类型           | 校对规则 |  可空的  |               预设
  -----------+-------------------------+----------+----------+----------------------------------
   id        | integer                 |          | not null | nextval('post_id_seq'::regclass)
   poster_id | integer                 |          | not null |
   host_id   | integer                 |          | not null |
   question  | character varying(1000) |          | not null |
   answer    | character varying(1000) |          |          |
   is_public | boolean                 |          | not null |
  索引：
      "post_pkey" PRIMARY KEY, btree (id)
  外部键(FK)限制：
      "post_host_id_fkey" FOREIGN KEY (host_id) REFERENCES auth_user(id)
      "post_poster_id_fkey" FOREIGN KEY (poster_id) REFERENCES auth_user(id)
  ```

#### Mysql 实施的自动编号

【问题】上面的 postgres 的预设 `nextval('post_id_seq'::regclass)` 是什么？

Mysql 也有类似功能。

> **Me：**mysql创建表格，自动按顺序编号
>
> **ChatGPT：**
>
> 在MySQL中，可以使用自增主键来自动按顺序编号表格中的数据。以下是创建表格并自动按顺序编号的示例：
>
> ```
> CREATE TABLE your_table (
>     id INT AUTO_INCREMENT PRIMARY KEY,
>     name VARCHAR(255),
>     age INT
> );
> ```
>
> 在上面的示例中，`id` 列被定义为 `INT AUTO_INCREMENT PRIMARY KEY`，这意味着它是一个自增主键，每次插入新数据时，它会自动递增并分配一个唯一的编号。
>
> 接下来，您可以插入数据到该表格中，而无需指定 `id` 列的值：
>
> ```
> INSERT INTO your_table (name, age)
> VALUES ('John', 25), ('Jane', 30), ('Bob', 35);
> ```
>
> 插入数据后，`id` 列将自动按顺序编号，如下所示：
>
> ```
> +----+------+-----+
> | id | name | age |
> +----+------+-----+
> |  1 | John |  25 |
> |  2 | Jane |  30 |
> |  3 | Bob  |  35 |
> +----+------+-----+
> ```
>
> 每次插入新数据时，`id` 列的值将自动递增。

---

> 在 Django 中，每当你创建一个新的模型，Django 会自动地为该模型创建一个名为'id'的自动增长字段，这个字段是主键，且默认按顺序编号。
>
> 如果你想要使用 MySQL 的自动按顺序编号功能，你只需要在模型中定义其他字段，Django 会自动处理'id'字段。
>
> 例如，这是一个简单的模型：
>
> ```python
> from django.db import models
> 
> class MyModel(models.Model):
>     name = models.CharField(max_length=100)
>     description = models.TextField()
> ```
>
> 在这个例子中，Django 会自动为`MyModel`创建一个'id'字段，这个字段会自动地按顺序编号。
>
> 但是，如果你想要自定义主键的名字，或者不想要使用自动增长的主键，你可以在模型中定义自己的主键，只需要在字段中设置`primary_key=True`即可。例如：
>
> ```python
> class MyModel(models.Model):
>     my_id = models.AutoField(primary_key=True)
>     name = models.CharField(max_length=100)
>     description = models.TextField()
> ```
>
> 在这个例子中，'my_id'就是自定义的主键，它会自动地按顺序编号。



~~cao，question 和 response 到底要不要合并成一个实啊！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！~~

~~要不要允许空值？？？？真的 SB~~

### 前后端交互接口

【TODO】
